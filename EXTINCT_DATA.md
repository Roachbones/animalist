# Extinct taxa data

`extinct.js` classifies each taxon in the game as extinct or extant.
It is generated by `find_extinct.py`, which queries the Wikidata SPARQL
endpoint.

## How it works

The script makes two SPARQL queries against https://query.wikidata.org:

1. **`?item wdt:P31/wdt:P279* wd:Q98961713`** -- finds all taxa whose
   P31 ("instance of") points to Q98961713 ("extinct taxon") or any
   subclass of it, such as Q23038290 ("fossil taxon"). The `/P279*`
   property path makes this transitive, so we don't need to enumerate
   subclasses manually. This is necessary because many extinct taxa
   (e.g. T. rex, woolly mammoth) are typed as "fossil taxon" rather
   than "extinct taxon" directly.

2. **`?item wdt:P141 wd:Q237350`** -- finds taxa with conservation
   status (P141) set to "extinct" (Q237350). This catches species like
   the dodo that are marked via conservation status rather than (or in
   addition to) their P31 class.

The union of these two queries is intersected with the Q-IDs in
`parent.js` and `id_to_title.js`.

### Why no downward propagation

An earlier version propagated extinction downward through the taxonomy
tree (if a parent clade is extinct, mark all children as extinct too).
This is wrong: birds are living dinosaurs, so propagating from
Dinosauria (which isn't even marked extinct in Wikidata, correctly)
would incorrectly mark all birds as extinct. The script relies on
Wikidata's per-taxon markings instead.

### Upward propagation

The script does propagate *upward*: if every child of a node in our
tree is extinct, the node itself is marked extinct too. This catches
intermediate nodes that Wikidata hasn't explicitly tagged.

### Extant counterexamples

For each extant taxon, the script walks down the tree to find a
leaf-level extant species and records its name. This lets the game
show messages like "Dog is not extinct. For example, Basenji is
still alive." when a player guesses a living animal in extinct mode.

## Regenerating

```
pip install requests
python3 find_extinct.py
```

This takes a couple of minutes. The script is polite to the SPARQL
endpoint (retries with backoff on rate limits and timeouts).

## Output format

`extinct.js` defines two variables:

- **`EXTINCT`**: object mapping Q-IDs to `true` (extinct) or a string
  (name of an extant counterexample species).
- **`EXTINCT_ANCESTORS`**: Set of extinct Q-IDs that are in the
  taxonomy tree but not directly guessable (no title in
  `id_to_title.js`). Available for ancestry checking.
